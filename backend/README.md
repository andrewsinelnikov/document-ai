# Document AI Backend

## Опис

FastAPI бекенд для AI-конструктора юридичних документів. Підтримує генерацію 4 типів договорів:

1. **Договір оренди квартири** (`rent_contract`)
2. **Договір надання послуг між ФОП** (`service_contract`) 
3. **Угода про нерозголошення (NDA)** (`nda_contract`)
4. **Договір позики між фізичними особами** (`loan_contract`)

## Встановлення

1. Перейти в папку backend:
```bash
cd backend
```

2. Встановити залежності:
```bash
pip install -r requirements.txt
```

3. Запустити сервер:
```bash
python -m uvicorn app.main:app --reload --port 8000
```

## API Endpoints

### GET /contracts/types
Отримати список всіх доступних типів договорів.

**Відповідь:**
```json
[
  {
    "id": "rent_contract",
    "title": "Договір оренди квартири",
    "description": "Договір найму житла між орендодавцем та орендарем"
  },
  ...
]
```

### GET /contracts/{contract_type}/template
Отримати шаблон для конкретного типу договору.

**Параметри:**
- `contract_type`: один з `rent_contract`, `service_contract`, `nda_contract`, `loan_contract`

**Відповідь:**
```json
{
  "id": "rent_contract",
  "title": "Договір оренди квартири",
  "description": "...",
  "fields": [
    {
      "id": "landlord_name",
      "label": "ПІБ орендодавця",
      "type": "text",
      "required": true,
      "validation": {
        "min_length": 5,
        "pattern": "^[А-ЯІЇЄґа-яіїєґ\\s\\-']+$"
      }
    },
    ...
  ],
  "template": { ... }
}
```

### POST /contracts/validate
Валідувати дані форми згідно з правилами шаблону.

**Тіло запиту:**
```json
{
  "contract_type": "rent_contract",
  "form_data": {
    "landlord_name": "Іванов Іван Іванович",
    "landlord_phone": "+380501234567",
    ...
  }
}
```

**Відповідь:**
```json
{
  "valid": true,
  "errors": []
}
```

### POST /contracts/generate
Згенерувати документ договору з даних форми.

**Тіло запиту:**
```json
{
  "contract_type": "rent_contract", 
  "form_data": { ... }
}
```

**Відповідь:**
```json
{
  "contract_type": "rent_contract",
  "title": "Договір оренди квартири",
  "content": "**ДОГОВІР НАЙМУ ЖИТЛА**\n\n## 1. СТОРОНИ\n...",
  "generated_at": "2025-11-15T22:47:12.713547"
}
```

## Тестування

Запустити тести API:
```bash
python test_api.py
```

Це протестує всі endpoints з реалістичними даними для кожного типу договору.

## Структура файлів

```
backend/
├── app/
│   ├── main.py              # Основний FastAPI додаток
│   └── templates/           # JSON шаблони договорів
│       ├── rent_contract.json
│       ├── service_contract.json
│       ├── nda_contract.json
│       └── loan_contract.json
├── requirements.txt         # Залежності Python
├── test_api.py             # Тести API
└── README.md              # Ця документація
```

## Можливості

### Валідація полів
- Regex патерни для телефонів, паспортів, email
- Перевірка мінімальних/максимальних значень
- Валідація дат (майбутні дати, взаємозв'язані дати)
- Обов'язкові та умовні поля

### Типи полів
- `text` - текстові поля
- `textarea` - багаторядкові текстові поля
- `number` - числові поля
- `money` - грошові суми
- `date` - дати
- `phone` - телефони
- `email` - email адреси
- `boolean` - так/ні поля
- `select` - поля з вибором варіантів

### Генерація документів
- Заміна змінних у шаблонах
- Умовна логіка для різних варіантів тексту
- Автоматичне мапінг значень (наприклад, `monthly` → `щомісячно рівними частинами`)
- Форматування дат та булевих значень українською мовою

## Статус

✅ **Завершено (Дні 1-2):**
- Створення JSON шаблонів для 4 типів договорів
- Реалізація FastAPI REST API
- Система валідації полів
- Генерація документів з шаблонів
- Комплексне тестування

## Наступні кроки (Дні 3+)

- Інтеграція з AI для автозаповнення
- Генерація PDF документів  
- Розширені шаблони та валідації
- Інтеграція з фронтендом